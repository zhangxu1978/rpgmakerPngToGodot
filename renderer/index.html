<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>简单图片编辑器</title>
    <link rel="stylesheet" href="style.css">
    <script src="../node_modules/pica/dist/pica.min.js"></script>
</head>

<body>
    <div class="app-container">
        <!-- 工具栏 -->
        <div class="toolbar">
            <div class="tool-group">
                <button id="open-btn" class="tool-btn">打开图片</button>
                <button id="export-btn" class="tool-btn">导出PNG</button>
            </div>

            <div class="tool-group">
                <button id="resize-btn" class="tool-btn">压缩图片</button>
                <input type="number" id="resize-width" min="1" value="96" class="resize-input">
                <span class="resize-separator">×</span>
                <input type="number" id="resize-height" min="1" value="96" class="resize-input">
                <label class="pica-checkbox-container">
                    <input type="checkbox" id="use-pica-checkbox" class="pica-checkbox">
                    <span class="checkbox-label">pica</span>
                </label>
                <button id="remove-bg-btn" class="tool-btn">去除背景</button>
                <input type="range" id="tolerance-slider" min="0" max="100" value="20" class="tolerance-slider">
                <span class="tolerance-value">容差: 20</span>
            </div>

            <div class="tool-group">
                <button id="slice-btn" class="tool-btn">切图</button>
                <button id="auto-mark-btn" class="tool-btn">自动打标</button>
                <input type="number" id="slice-width" min="1" value="48" class="slice-input">
                <span class="slice-separator">×</span>
                <input type="number" id="slice-height" min="1" value="48" class="slice-input">
            </div>

            <div class="tool-group">
                <button id="combine-btn" class="tool-btn">组合图片</button>
            </div>
        </div>

        <!-- 主内容区 -->
        <div class="main-content">
            <!-- 画布容器 - 主区域 -->
            <div class="canvas-container" id="main-canvas-container">
                <canvas id="main-canvas"></canvas>
                <div class="canvas-placeholder" id="canvas-placeholder">
                    <div class="placeholder-text">点击"打开图片"或拖拽图片到此处</div>
                </div>
            </div>

            <!-- 组合图片区 - 主区域 -->
            <div class="combine-area" id="combine-area" style="display: none;">
                <h3>组合图片</h3>

                <!-- 组合工具栏 -->
                <div class="combine-toolbar">
                    <div class="grid-settings">
                        <label>网格大小:</label>
                        <input type="number" id="grid-width" min="1" value="48" class="grid-input">
                        <span>×</span>
                        <input type="number" id="grid-height" min="1" value="48" class="grid-input">
                    </div>
                    <div class="grid-settings">
                        <label>行列数:</label>
                        <button id="remove-col-btn" class="grid-add-btn">-</button>
                        <input type="number" id="grid-cols" min="1" value="10" class="grid-input">
                        <button id="add-col-btn" class="grid-add-btn">+</button>
                        <span>列 ×</span>
                        <button id="remove-row-btn" class="grid-add-btn">-</button>
                        <input type="number" id="grid-rows" min="1" value="10" class="grid-input">
                        <button id="add-row-btn" class="grid-add-btn">+</button>
                        <span>行</span>
                        <button id="update-grid-btn" class="tool-btn">更新网格</button>
                    </div>
                    <button id="toggle-materials-btn" class="tool-btn">切换素材库</button>
                    <button id="add-images-btn" class="tool-btn">添加图片</button>
                    <button id="add-slices-btn" class="tool-btn">添加切片</button>
                    <button id="clear-grid-btn" class="tool-btn">清空网格</button>
                    <button id="save-combined-btn" class="tool-btn">保存组合</button>
                    <button id="toggle-properties-btn" class="tool-btn">属性面板</button>
                </div>

                <!-- 组合工作区 - 主放置区 -->
                <div class="combine-workspace-main">
                    <!-- 右侧放置区 - 主区域 -->
                    <div class="placement-panel-main">
                        <div class="placement-container">
                            <div class="grid-overlay" id="grid-overlay"></div>
                            <canvas id="combine-canvas"></canvas>
                            <div class="grid-cells" id="grid-cells"></div>
                        </div>
                    </div>

                    <!-- 左侧素材区 - 抽屉式 -->
                    <div class="materials-panel-drawer" id="materials-drawer">
                        <div class="materials-drawer-header">
                            <h4>素材库</h4>
                            <div class="header-actions">
                                <button id="clear-materials-btn" class="tool-btn small-btn"
                                    style="padding: 2px 8px; margin-right: 5px; font-size: 12px;">清空</button>
                                <button id="close-materials-btn" class="close-btn">×</button>
                            </div>
                        </div>
                        <div class="materials-list" id="materials-list"></div>
                    </div>

                    <!-- 属性面板 -->
                    <div class="properties-panel" id="properties-panel" style="display: none;">
                        <div class="properties-header" id="properties-header">
                            <h4>快速属性设置</h4>
                            <div class="header-actions">
                                <span class="drag-handle">⋮⋮</span>
                                <button id="close-properties-btn" class="close-btn">×</button>
                            </div>
                        </div>
                        <div class="properties-content">
                            <!-- 属性名称 -->
                            <div class="property-group">
                                <label>属性名称:</label>
                                <input type="text" id="property-name-input" class="property-input" placeholder="输入属性名称">
                            </div>
                            
                            <!-- 碰撞设置 -->
                            <div class="property-group">
                                <label>碰撞:</label>
                                <div class="property-buttons">
                                    <button class="property-btn" data-collision="0">无碰撞</button>
                                    <button class="property-btn" data-collision="1">有碰撞</button>
                                </div>
                            </div>
                            
                            <!-- 导航设置 -->
                            <div class="property-group">
                                <label>导航:</label>
                                <div class="property-buttons">
                                    <button class="property-btn" data-navigation="0">不可导航</button>
                                    <button class="property-btn" data-navigation="1">可导航</button>
                                </div>
                            </div>
                            
                            <!-- 拆分类型 -->
                            <div class="property-group">
                                <label>拆分类型:</label>
                                <div class="property-buttons">
                                    <button class="property-btn" data-split-type="47tile">47tile</button>
                                    <button class="property-btn" data-split-type="9tile">9tile</button>
                                    <button class="property-btn" data-split-type="16tile">16tile</button>
                                </div>
                            </div>
                            
                            <!-- 快捷类型选择 -->
                            <div class="property-group">
                                <label>快捷类型:</label>
                                <div class="dropdown-container">
                                    <select id="category-select" class="property-dropdown">
                                        <option value="">选择分类</option>
                                    </select>
                                    <select id="type-select" class="property-dropdown" disabled>
                                        <option value="">选择类型</option>
                                    </select>
                                </div>
                            </div>
                            
                            <!-- 应用按钮 -->
                            <div class="property-group">
                                <button id="apply-properties-btn" class="tool-btn" style="width: 100%;">应用到选中区域</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 切图预览区 - 抽屉式 -->
            <div class="slice-preview-drawer" id="slice-preview" style="display: none;">
                <div class="drawer-header">
                    <h3>切图预览</h3>
                </div>
                <div class="slice-grid" id="slice-grid"></div>
                <div class="slice-preview-actions">
                    <button id="save-slices-btn" class="save-btn">保存所有切片</button>
                    <div class="preset-export-group">
                        <label>预设导出:</label>
                        <select id="preset-select" class="preset-select">
                            <option value="">选择预设</option>
                            <option value="9tile">9tile</option>
                            <option value="16tile">16tile</option>
                            <option value="48tile">48tile</option>
                        </select>
                        <button id="export-preset-btn" class="tool-btn">导出预设图片</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 状态栏 -->
        <div class="status-bar">
            <span id="status-text">就绪</span>
        </div>
    </div>

    <script src="app.js"></script>
</body>

</html>